<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Stacked Bar & Line Chart</title>
  <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>

  <style>
    body {
      font-family: 'Be Vietnam Pro', sans-serif;
      background: #ffffff;
      margin: 0;
      padding: 0;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    #chart {
      width: 100%;
      height: 100vh;
    }
  </style>
</head>

<body>

<div id="chart"></div>

<script>
  // --- Thiết lập Dữ liệu ---
  const hours = Array.from({ length: 24 }, (_, i) => `${i}:00`);
  
  // Ngày So Sánh Cố định theo yêu cầu
  const compareStr = '2025-11-13'; 

  // Dữ liệu mô phỏng: Bar data (iOS và Android) chỉ có đến 12:00 (index 12) để mô phỏng dữ liệu trong ngày
  // Tổng số điểm dữ liệu hiện tại là 13 (từ 0:00 đến 12:00)
  const dataExtent = 13;

  const iOSData = [
    150, 100, 80, 50, 120, 250, 400, 550, 750, 880, 950, 900, 850
  ];
  const androidData = [
    250, 200, 150, 120, 180, 450, 700, 800, 1100, 1320, 1500, 1450, 1300
  ];
  
  // Dữ liệu Line Chart (2025-11-13 - mô phỏng đường màu cam)
  // Dữ liệu này chạy full 24 giờ
  const compareData = [
    800, 750, 680, 550, 600, 900, 1500, 2200, 3000, 3500, 3200, 3000,
    3500, 3300, 3050, 2500, 2300, 2700, 2900, 2500, 2000, 1500, 1200, 800
  ];
  
  // Hàm tạo mảng dữ liệu với `null` cho các giờ chưa có dữ liệu (Realtime)
  const getRealtimeData = (data) => {
    return hours.map((_, i) => (i < data.length ? data[i] : null));
  };
  
  const finaliOSData = getRealtimeData(iOSData);
  const finalAndroidData = getRealtimeData(androidData);


  // --- Thiết lập ECharts Option ---
  const option = {
    // Màu sắc cố định cho các series (sử dụng màu tương tự hình ảnh)
    color: ['#1e7bff', '#4CAF50', '#ff7844'], // Blue (iOS), Green (Android), Red-Orange (2025-11-13)

    tooltip: {
      trigger: 'axis',
      axisPointer: { type: 'shadow' },
      backgroundColor: 'rgba(255,255,255,0.95)',
      textStyle: { fontFamily: 'Be Vietnam Pro', color: '#000' },
      formatter: function(params) {
        let html = `<div style="font-family:'Be Vietnam Pro',sans-serif;"><strong>${params[0].axisValue}</strong><br/>`;
        
        let barTotal = 0;
        let lineValue = null;

        // Xử lý Bar charts (iOS, Android)
        params.filter(p => p.seriesType === 'bar').forEach(p => {
            if (p.value !== null) {
                html += `${p.marker} ${p.seriesName}: ${p.value.toLocaleString()}<br/>`;
                barTotal += p.value;
            }
        });

        // Xử lý Line chart (2025-11-13)
        params.filter(p => p.seriesType === 'line').forEach(p => {
             if (p.value !== null) {
                html += `${p.marker} ${p.seriesName}: ${p.value.toLocaleString()}<br/>`;
                lineValue = p.value;
            }
        });
        
        // Có thể thêm logic so sánh tại đây nếu cần
        
        html += `</div>`;
        return html;
      }
    },

    legend: {
      bottom: 0,
      left: 'center',
      icon: 'circle',
      textStyle: { fontFamily: 'Be Vietnam Pro' },
      data: [
        { name: 'iOS', itemStyle: { color: '#1e7bff' } },
        { name: 'Android', itemStyle: { color: '#4CAF50' } },
        // Đặt tên chú giải theo yêu cầu
        { name: compareStr, itemStyle: { color: '#ff7844' } } 
      ]
    },

    grid: {
      top: 40,
      left: 50,
      right: 30,
      bottom: 60,
      containLabel: true // Đảm bảo nhãn trục Y không bị cắt
    },

    xAxis: {
      type: 'category',
      data: hours,
      axisLabel: { 
        fontFamily: 'Be Vietnam Pro',
        interval: 1 // Hiển thị tất cả các giờ
      },
      axisLine: { onZero: false },
      splitLine: { show: false }
    },

    yAxis: {
      type: 'value',
      axisLabel: {
        fontFamily: 'Be Vietnam Pro',
        formatter: v => v.toLocaleString()
      },
      splitLine: { lineStyle: { type: 'dashed' } }
    },

    series: [
      {
        name: 'iOS',
        type: 'bar',
        stack: 'total', // Stacked bar chart
        data: finaliOSData,
        itemStyle: { color: '#1e7bff' },
        barMaxWidth: 20
      },
      {
        name: 'Android',
        type: 'bar',
        stack: 'total', // Stacked bar chart
        data: finalAndroidData,
        itemStyle: { color: '#4CAF50' },
        barMaxWidth: 20
      },
      {
        name: compareStr,
        type: 'line',
        smooth: true,
        // Yêu cầu: line chart showSymbol: false
        showSymbol: false, 
        symbolSize: 6, // Kích thước symbol mặc dù không hiển thị
        data: compareData,
        yAxisIndex: 0,
        itemStyle: { color: '#ff7844' },
        lineStyle: { 
            width: 2, 
            type: 'dashed', // Dùng đường đứt nét
            color: '#ff7844'
        }
        // KHÔNG THÊM markArea để loại bỏ vùng xám
      }
    ]
  };

  const chartDom = document.getElementById('chart');
  const myChart = echarts.init(chartDom);
  myChart.setOption(option);

  window.addEventListener('resize', () => myChart.resize());
</script>

</body>
</html>