<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Accumulated RR1 Chart</title>
  <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>

  <style>
    body {
      font-family: 'Be Vietnam Pro', sans-serif;
      background: #ffffff;
      margin: 0;
      padding: 0;
      height: 100vh;
      display: flex;
      justify-content: center;
      align-items: center;
    }
    #chart {
      width: 100%;
      height: 100vh;
    }
  </style>
</head>

<body>

<div id="chart"></div>

<script>
  const hours = Array.from({ length: 24 }, (_, i) => `${i}:00`);

  const todayStr = "2025-11-13";
  const compareStr = "2025-11-12";

  // ===========================
  // SAMPLE DATA: Accumulated RR1 %
  // ===========================
  function genRR1() {
    let arr = [];
    let curr = 0;
    for (let i = 0; i < 24; i++) {
      curr += (Math.random() * 4); // tăng dần
      if (curr > 100) curr = 100;
      arr.push(parseFloat(curr.toFixed(1)));
    }
    return arr;
  }

  const todayData = genRR1();
  const compareData = genRR1();

  const source = hours.map((h, i) => ({
    Hour: h,
    Today: todayData[i],
    Compare: compareData[i]
  }));

  const lastIdx = todayData.length - 1;
  const lastPoint = [hours[lastIdx], todayData[lastIdx]];

  const option = {
    color: ['#145dfc', '#03c950'],

    tooltip: {
      trigger: 'axis',
      axisPointer: { type: 'line' },
      backgroundColor: 'rgba(255,255,255,0.95)',
      textStyle: { fontFamily: 'Be Vietnam Pro', color: '#000' },

      formatter: params => {
        let html = `<div style="font-family:'Be Vietnam Pro',sans-serif;">`;
        html += `<strong>${params[0].axisValue}</strong><br/>`;

        let todayVal = null;
        let compareVal = null;

        params.forEach(p => {
          const formatted = p.value[1] != null ? p.value[1] + "%" : "–";

          // Forced green for compare series
          const markerColor = p.seriesIndex === 1 ? "#03c950" : p.color;
          const markerHtml =
            `<span style="display:inline-block;margin-right:4px;border-radius:10px;width:10px;height:10px;background-color:${markerColor};"></span>`;

          html += `${markerHtml} ${p.seriesName}: ${formatted}<br/>`;

          if (p.seriesIndex === 0) todayVal = p.value[1];
          if (p.seriesIndex === 1) compareVal = p.value[1];
        });

        if (todayVal != null && compareVal != null) {
          const diff = todayVal - compareVal;
          const diffPercent = diff;

          const sign = diffPercent >= 0 ? "▲" : "▼";
          const color = diffPercent >= 0 ? "#03c950" : "#EA3323";

          html += `<span style="color:${color};">${sign}${Math.abs(diffPercent).toFixed(1)}%</span> vs Same Time DoD`;
        }

        html += `</div>`;
        return html;
      }
    },

    legend: {
      bottom: 0,
      left: 'center',
      icon: 'circle',
      textStyle: { fontFamily: 'Be Vietnam Pro' },
      data: [
        `RR1 ${todayStr}`,
        {
          name: `RR1 ${compareStr}`,
          itemStyle: { color: '#03c950' }
        }
      ]
    },

    grid: {
      top: 40,
      left: 60,
      right: 30,
      bottom: 60
    },

    xAxis: {
      type: 'category',
      boundaryGap: false,
      data: hours,
      axisLabel: { fontFamily: 'Be Vietnam Pro' }
    },

    yAxis: {
      type: 'value',
      max: 100,
      axisLabel: {
        fontFamily: 'Be Vietnam Pro',
        formatter: v => v + "%"
      },
      splitLine: { lineStyle: { type: 'dashed' } }
    },

    series: [
      {
        name: `RR1 ${todayStr}`,
        type: 'line',
        smooth: false,
        showSymbol: false,
        data: source.map(d => [d.Hour, d.Today]),
        lineStyle: { width: 3, color: '#145dfc' },
        itemStyle: { color: '#145dfc' },
        label: {
          show: true,
          position: 'top',
          formatter: p =>
            p.dataIndex === todayData.length - 1
              ? p.value[1] + "%"
              : ''
        }
      },
      {
        name: `RR1 ${compareStr}`,
        type: 'line',
        smooth: false,
        symbol: 'none',
        lineStyle: { width: 2, color: '#03c950', type: 'dashed' },
        data: source.map(d => [d.Hour, d.Compare])
      },
      {
        type: 'effectScatter',
        coordinateSystem: 'cartesian2d',
        data: [lastPoint],
        symbolSize: 12,
        rippleEffect: { brushType: 'stroke', scale: 4, period: 3 },
        itemStyle: { color: '#145dfc', shadowBlur: 20, shadowColor: '#145dfc' },
        tooltip: { show: false },
        zlevel: 1
      }
    ]
  };

  const chartDom = document.getElementById('chart');
  const myChart = echarts.init(chartDom);
  myChart.setOption(option);

  window.addEventListener('resize', () => myChart.resize());
</script>

</body>
</html>
