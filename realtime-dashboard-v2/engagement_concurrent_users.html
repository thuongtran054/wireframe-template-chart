<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.jsdelivr.net/npm/echarts@5/dist/echarts.min.js"></script>
  <title>CCU Minute Chart</title>
  <style>
    body {
      margin: 0;
      background: #fff;
      font-family: 'Be Vietnam Pro', sans-serif;
    }
    #chart {
      width: 100%;
      height: 100vh;
    }
  </style>
</head>
<body>

<div id="chart"></div>

<script>
  const minuteCount = 1440; // 3 hours (đổi thành 1440 nếu muốn full 24h)
  const start = new Date("2025-11-14 00:00:00");

  // ===== Generate Minutes =====
  const labels = [];
  for (let i = 0; i < minuteCount; i++) {
    const d = new Date(start.getTime() + i * 60000);
    labels.push(
      d.toTimeString().slice(0, 5) // HH:mm
    );
  }

  // ===== CCU Pattern (giống ảnh) =====
  function generateCCUPattern() {
    let arr = [];
    let base = 18; // start around 18 users

    for (let i = 0; i < minuteCount; i++) {
      // random strong fluctuation (zigzag)
      const noise = (Math.random() - 0.5) * 6;

      // gradually trend downward then upward
      const trend =
        Math.sin(i / 20) * 5 +
        Math.sin(i / 50) * 7;

      const value = Math.max(0, base + trend + noise);
      arr.push(Math.round(value));
    }

    return arr;
  }

  const ccuData = generateCCUPattern();

  // ===== Active Server =====
  const activeServer = 25;
  const serverData = Array(minuteCount).fill(activeServer);

  // ===== ECharts Option =====
  const option = {
    tooltip: {
      trigger: "axis",
      backgroundColor: "rgba(255,255,255,0.95)",
      textStyle: { color: "#000", fontFamily: "Be Vietnam Pro" },
      formatter: (params) => {
        let html = `<strong>${params[0].axisValue}</strong><br/>`;
        params.forEach((p) => {
          const marker = `<span style="display:inline-block;margin-right:4px;width:10px;height:10px;border-radius:50%;background:${p.color};"></span>`;
          html += `${marker}${p.seriesName}: ${p.value}<br/>`;
        });
        return html;
      }
    },

    legend: {
      bottom: 0,
      left: "center",
      icon: "circle",
      textStyle: { fontFamily: "Be Vietnam Pro" },
      data: ["Concurrent Users", "Active Server"]
    },

    grid: {
      top: 30,
      left: 60,
      right: 50,
      bottom: 60
    },

    xAxis: {
      type: "category",
      data: labels,
      axisLabel: {
        fontFamily: "Be Vietnam Pro",
        rotate: 50
      }
    },

    yAxis: [
      {
        type: "value",
        name: "User",
        axisLabel: {
          formatter: v => v,
          fontFamily: "Be Vietnam Pro"
        },
        splitLine: { lineStyle: { type: "dashed" } }
      },
      {
        type: "value",
        name: "Active Server",
        min: 0,
        max: 30,
        axisLabel: { fontFamily: "Be Vietnam Pro" },
        splitLine: { show: false }
      }
    ],

    series: [
      {
        name: "Concurrent Users",
        type: "line",
        data: ccuData,
        smooth: false,
        showSymbol: false,
        lineStyle: { width: 2, color: "#1A73E8" }
      },
      {
        name: "Active Server",
        type: "line",
        yAxisIndex: 1,
        data: serverData,
        showSymbol: false,
        lineStyle: {
          width: 3,
          color: "#E85D1A"
        }
      }
    ]
  };

  const chart = echarts.init(document.getElementById("chart"));
  chart.setOption(option);

  window.addEventListener("resize", () => chart.resize());
</script>

</body>
</html>
